# Week6 实验报告

---

# 一、 实验任务概述

本周任务旨在通过 Windows 上位机工具对实车传感器（激光雷达、双目相机）进行初步硬件健康检查，并完成双目相机的视差学习标定。随后转入 Ubuntu 环境进行系统集成校验***（注：后一部分因车辆系统异常按指示跳过）。***

---

# **二、 详细操作流程**

## 准备阶段：软件与驱动准备

1. **下载上位机**
2. **解压**：看到 LSLIDAR（雷达软件）和 FieldHelper（相机软件）
3. **确认权限**：稍后在 Windows 下运行这两个软件时，**右键点击图标 -> 选择“以管理员身份运行”**。

---

## 第 1 步：网络与环境配置

**目的**：让Windows 笔记本能跟车上的传感器连接

1. **物理连接（找对接口）**：
    - 使用网线连接电脑和车上的网口。
2. **关闭车辆工控机**：
    - **确认车辆上的 Ubuntu 系统处于关机状态**。
    - *原因*：避免车辆系统抢占传感器信号，导致 IP 冲突。
3. **关闭 Windows 防火墙**：
    - 路径：控制面板 -> 系统和安全 -> Windows Defender 防火墙 -> 启用或关闭防火墙。
    - **操作**：将“专用网络”和“公用网络”全部选为“**关闭**”，点击确定。
4. **手动设置静态 IP**：
    - 路径：右键右下角网络图标 -> 网络和 Internet 设置 -> 以太网 -> IP 分配 -> 点击“编辑”。
    - 设置为“**手动**”，开启“**IPv4**”。
    - **IP 地址**：192.168.1.102
    - **子网掩码**：255.255.255.0
    - **网关**：192.168.1.1 | **DNS**：8.8.8.8
    - 保存并确认。

---

## 第 2 步：【Windows 环境】硬件检测与相机标定

**目的**：利用厂家专用工具完成初步体检和相机校准。

### 1. 激光雷达 (LiDAR) 检测

1. **运行**：管理员身份打开 LSLIDAR 软件。
2. **连接**：点击界面左上角“**连接**”图标。
3. **观察**：确认实时点云覆盖 360° 环境，画面稳定。
    - 画面黑屏时，滚动鼠标中键缩小画面。
4. **【注意】**只看，不点任何“写入”、“保存”或修改频率的按钮，看完直接关闭软件。

![1.png](Week6%20%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/1.png)

### 2. 双目相机 (Camera) 标定

1. **运行**：管理员身份打开 FieldHelper。
2. **连接**：点击“**离线登录**” -> “连接设备” -> 输入 IP 192.168.1.251。
3. **初始化**：点击“**恢复出厂设置**”清空旧数据。
4. **安装配置**：点击“安装设备”，确认左/右目画面正常且不黑屏。输入测量的物理参数（高度、距离等）。
5. **姿态学习**：模式选择“**视差学习**”，点击“开始学习”，等待进度条完成。
6. **同步完成**：后续预警/同步设置直接点“保存并下一步”，直到提示“**配置成功**”。
7. **确认状态**：重启后主页状态应显示为“**已安装**”。

![2.png](Week6%20%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/2.png)

![3.png](Week6%20%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/3.png)

![4.png](Week6%20%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/4.png)

![5.png](Week6%20%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/5.png)

![6.png](Week6%20%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/6.png)

---

## 第 3 阶段：系统环境切换

**目的**：从 Windows 标定模式切换回 Apollo 工作模式。

1. **断开连接**：退出所有 Windows 软件，拔掉笔记本网线。
2. **整车重启**：**先给车辆彻底断电，再重新上电**。
    - *原因*：标定后需断电重载，且 CAN 卡需重新初始化才能被 Ubuntu 识别。
3. **启动系统**：开启车辆上的 Ubuntu 系统。

---

## 第 4 阶段：【Ubuntu 系统】底层通讯巡检

**目的**：在 Linux 底层确认硬件链路是否打通。

1. **检测 CAN 总线**：终端输入 candump can0。
    - **合格标准**：数据帧飞速跳动，且左侧 ID 包含**两种以上不同 ID**（说明底盘反馈完整）。
2. **检测网络连接**：
    - 输入 ping 192.168.1.200（测雷达）。
    - 输入 ping 192.168.1.251（测相机）。
    - 显示 time=0.x ms 表示通信正常。

---

## 第 5 阶段：【Docker 内部】Apollo 数据流校验

**目的**：确保自动驾驶软件能正确读懂数据。

1. **进入环境**：cd /apollo -> bash docker/scripts/dev_into.sh。
2. **启动 Dreamview**：执行 bash scripts/bootstrap.sh，浏览器打开 localhost:8888。
3. **点亮模块**：在 Module Controller 页面，点亮 **GPS、IMU、定位、CAN总线、激光雷达、相机、超声波、毫米波** 共 8 个开关（变蓝）。
4. **校验频率 (rostopic hz)**：
    - 回到终端（Docker 内部）。
    - 检查雷达频率：rostopic hz /apollo/sensor/lidar16/PointCloud2（应显示约 **10Hz**）。
    - 检查相机频率：rostopic hz /apollo/sensor/camera/obstacle/front_6mm（应显示**稳定流**）。
5. **校验数据内容 (rostopic echo)**：

| **模块/传感器名称** | **Topic 话题** | **检查要点** |
| --- | --- | --- |
| **超声波雷达** | /apollo/sensor/ultrasonic_radar | 确认是否有 8-12 路测距数值输出 |
| **毫米波雷达** | /apollo/sensor/conti_radar | 是否能检测并回传障碍物信息 |
| **组合导航** | /apollo/sensor/gnss/best_pose | 查看其输出内容 |
| **惯导** | /apollo/sensor/gnss/imu | 三轴加速度与角速度是否有数据刷新 |
| **底盘反馈** | /apollo/canbus/chassis | 车速与转向角等信息是否与实车同步 |
| **定位结果** | /apollo/localization/pose | 查看其输出内容 |

---

## 第 6 阶段：电脑状态复原

1. **恢复防火墙**：控制面板 -> 重新点击“启用”防火墙（专用和公用都开启，图标变绿）。
2. **恢复自动 IP**：
    - 以太网设置 -> IP 分配 -> 编辑。
    - 将“手动”改回“**自动 (DHCP)**”。同时确认 DNS 分配也为“自动”。

---

# **三、 问题解决**

在实操过程中，我遇到了一些问题，并顺利解决：

1. **VC++ 环境安装失败**
    - **现象**：运行 vc_redist.x64 提示“设置失败，已安装另一个版本”。
    - **解决**：识别到电脑已具备更高版本的运行库，直接关闭弹窗，软件可正常运行。
2. **上位机软件无法启动 (SmartScreen)**
    - **现象**：Windows 弹出蓝色警告窗口阻止运行。
    - **解决**：点击“更多信息”，选择“仍要运行”，并始终坚持“右键以管理员身份运行”以确保权限。
3. **LSLIDAR 提示“未侦测到设备”/ PING 不通**
    - **现象**：连接网线后软件报错，ping 192.168.1.200 提示超时。
    - **解决**：
        - 通过 ipconfig 发现静态 IP 未保存成功（显示为 169.254.x.x），重新设置并强制保存后，Ping 顺利接通。
4. **点云画面黑屏**
    - **现象**：软件连接成功且有数据跳动，但右侧画面全黑。
    - **解决**：识别为视角缩放问题，通过滚动鼠标滚轮缩小画面，成功看到点云。
5. **相机图像数据出错**
    - **现象**：标定过程中提示“图像数据出错”。
    - **解决**：分析为现场环境玻璃反射严重导致特征点识别失败。采取“跳过该步骤”策略，直接进入核心的“视差学习”环节，最终完成标定任务。

---

# 🌟 总结

通过本周实操，我深刻体会到自动驾驶硬件系统对**网络环境**的敏感性。静态 IP 的准确性、防火墙的拦截、以及多设备间的 IP 冲突是导致连接失败的主要原因。虽然车辆系统问题导致后半程任务受阻，但前半程的硬件直连与标定经验为后续排查系统错误打下了坚实基础。